
# 数据库

- 数据库是长期存储在计算机内、有组织、可共享的大量数据的集合。
- 数据库中的数据按一定的数据模型组织、描述和存储，具有较小的冗余度、较高的数据独立性和易扩展性，并为各种用户共享。
- 数据库的四个概念
    * 数据:数据库中存放的基本对象
    * 数据库：存放数据的仓库
    * 数据库管理系统DBMS：
    * 数据库系统DBS
- 数据模型
    * 概念模型：根据用户的观点来对数据和信息建模
        * 信息世界中的基本概念
            - 实体
            - 属性
            - 码：唯一表示实体的属性集
            - 实体集：同一类型实体的集合
            - 联系：不同实体集之间额关系
    * 逻辑模型：
        * 层次模型
            - 有且只有一个节点没有双亲节点，即根节点
            - 根节点以外的其他节点有且只有一个双亲节点
        * 网状模型
            - 允许一个以上的节点无双亲
            - 一个节点可以有多余一个的双亲
        * 关系模型
            - 每个关系的数据结构是一张规范化的二维表
            - 术语
                - 关系：对应一张表
                - 元组：一行
                - 属性：一列
                - 码：能够唯一确定一个元组的属性
                - 域：具有相同数据类型的值的集合
                - 分量：元组中的一个属性值
            - 关系的完整性约束条件：
                - 实体完整性
                - 参照完整性
                - 用户定义完整性
        * ....
    * 物理模型：是对数据最底层的抽象
    ---
    首先要将现实世界抽象成信息世界，然后将信息世界转换为机器世界。
- 数据库中三级模式结构
    - 模式（逻辑模式）：数据库中全体数据的逻辑结构和特征的描述
    - 外模式（子模式/用户模式）：是数据库用户能够看见和使用的局部数据的逻辑结构和特征的描述，是数据库用户的数据视图，是与某一应用有关的数据的逻辑表示。
    - 内模式（存储模式）：一个数据库只有一个内模式，他是数据物理结构和存储方式的描述方式。
- 数据库管理系统：
    - 数据库，数据库管理系统，应用程序和数据管理员

- 候选码
    * 某一属性组的值能够唯一地标识一个元组，而其子集不能，则称该属性组为候选码
    * 若一个关系有多个候选码，则选定其中一个为主码
    * 候选码的诸属性称为主属性，不包含在任何候选码中的属性称为非主属性或非码属性。
    * 极端情况下，关系模式的所有属性是这个关系模式的候选码，称为全码
- 关系
    * 基本关系（基本表）：实际存在的表，实际存储数据的逻辑表示
    * 查询表：查询结果对应的表
    * 视图表：是由基本表或者其他视图表导出的表，虚表不对应实际存储的数据
- 完整性
    * 实体完整性：若属性A是基本关系R的主属性，则A不能取空值
    * 参照完整性：若属性F是基本关系R的外码，他与基本关系S的主码K相对应，对于R的每个元组在F上的值必须：
        * 或者取空 
        * 或者等于S中的某个K的值
    * 用户定义完整性：针对某一具体关系的数据库的约束条件，他反映某一具体所涉及的数据必须满足的语义要求。
- 创建表：
```
create table `test` (
    `id` int ,
    `class_id` int
    primary key(id),
    foreign key(class_id) references class(class_id)
);
```

- 向表中新增一列
```
ALTER TABLE `student` ADD `S_entrance` DATE; 
```
- 修改一列的数据类型
```
ALTER TABLE `student` ALTER COLUMN `Sage` INT;
```

- 删除一个表
```
DROP TABLE `student` CASCADE;
```
默认为RESTRICT，删除的表不能被其他表所引用
CASCADE删除基本表的同时，相关的依赖对象都被一起删除。
- 创建索引
```
CREATE INDEX `index_name` ON Student(student_id);
```

- 修改索引
```
ALTER INDEX `index_name` RENAME TO `new_index_name`;
```
- 删除索引
```
DROP INDEX `index_name`;
```
- 查询插入
```
INSERT INTO `student` 
SELECT ...
FROM 
`table2`;
```
- 空值的判断，用is或者not is 来判断，不要用=

- 建立视图
```
CREATE VIEW `view_test`
AS
SELECT * FROM  `student`;
```
- 数据库的安全性
    - 保护数据库防止不合法使用所造成的数据泄露、更换、破坏。
    - 用户身份鉴别
        - 静态口令鉴别
        - 动态口令鉴别
        - 生物特征鉴别
        - 智能卡鉴别
    - 存取控制
- 范式
    - 第一范式：属性不可再分
    - 第二范式：每一个非主属性完全函数依赖于任何一个候选码（达到完全函数依赖）
    - 第三范式：消除传递依赖
- E-R图：为了简化E-R图的处置，现实世界的事物能够作为属性对待的尽量作为属性对待。
    - 作为属性，不能再具有需要描述的性质
    - 属性不能和其他实体具有联系
- 各子系统的E-R图之间的冲突主要有三类
    - 属性冲突
    - 命名问题
    - 结构冲突
- 事务
    - 事务是用户定义的一个数据库操作序列
- 故障的分类
    - 事务内部的故障
    - 系统故障
    - 介质故障
    - 计算机病毒
- 恢复的技术
    - 数据转储
    - 登记日志文件
- 并发控制的技术
    - 封锁
        * 排它锁（写锁）：X锁
        * 共享锁（读锁）：S锁
    - 时间戳
    - 乐观控制法
    - 多版本并发控制
- 封锁协议
    - 一级封锁协议：事务T在修改数据R之前必须对其加写锁，读完后再释放
    - 二级封锁协议：在一级封锁协议的基础上增加事务T在读取数据R之前必须对其加S锁，读完才可释放
    - 三级封锁协议：在一级封锁协议的基础上增加事务T在读取数据R之前必须对其加S锁，直到事务结束才释放。
    
